[bluestronica.github.io/C](https://bluestronica.github.io/C)

# 올바른 오류처리 방법

### C에서의 오류처리
- C 언어는 예외(exception)을 지원하지 않음
- 예외 처리가 언제나 좋은 것은 아니다.
- 오류 처리를 할 때도 원칙이 있어야 한다.

### 어서트

### 널 포인터를 허용한다면 함수나 변수에 명시!
- 함수의 매개변수가 널 포인터를 허용한다면, 매개변수 이름 끝에 '_or_null'을 붙인다.
- 함수도 마찬가지

### 실행 중 오류 처리는??
- 버그가 없는 상황인 경우
  - 즉, 내 함수에 들어오는 데이터는 다 유효(valid)
- 유효하지 않은 데이터가 들어오면 어디선가 걸러줘야 함
  - 그 어딘가를 '경계'(boundary)라고 부르자
  - 내 프로그램 | | 파일 시스팀
  - 내 프로그램 | | 키보드 입력
  - 내 프로그램 | | 외부 라이브러리(3rd-party library)

### 오류 코드를 반환하자!
- 오류를 처리해주는 함수 / 코드에서 오류가 있음을 알려줘야 함
- 가장 좋은 방법은 함수에서 곧바로 오류 코드 반환하는 것
```c
libabc_error_t try_get_student(int id, student_info_t* out_student)
{
  size_t idx;
  // 코드 생략
  if (idx == -1)
  {
    return ERROR_STUDENT_NOTFOUND;
  }
  
  return ERROR_NONE;
}
```

### 모든 오류 코드를 하나의 enum으로 만들자!
- 구조체로 반환도 가능하나 C에서 많이 쓰는 방법은 아님
  - 아마 용량 때문?
  - 그래도 좋은 방법이니 쓰길
- 오류 코드 만들 때는 해당 라이브러리에서 제공할 수 있는 모든 오류 코드를 enum으로 정의하는 게 좋다.
```c
typedef enum
{
  ERROR_NONE,
  ERROR_BAD_REQUEST,
  ERROR_UNAUTHORIZED,
  ERROR_FORBIDDEN,
  // 한 100개의 오류 코드 
} libabc_error_t;
```

### 올바른 오류 처리 전략 정리
  - 기본적으로 내가 작성하는 모든 함수에 들어오는 데이터는 유효하다 가정하고 어서트를 많이 쓸 것
  - 그렇지 안은 함수는 매개변수나 함수 이름에서 그렇지 않다는 사실을 명백히 표시할 것
  - 오류 상황을 처리하는 장소는 최소한으로 할 것
  - 어떤 함수가 오류 처리를 한다는 사실을 반환형 등을 통해 확실히 보여줄 것

### 그대로 프로그램이 오작동하면?
- 버그임
- 코드를 다시 고쳐야 함
- 어떤 경우에는 크래시도 남
  - 널 포인터 역 참조 등 
